---
- name: Install and configure Apache HTTP server
  hosts: all
  become: yes
  tasks:
    - name: Update packages
      command: yum update -y

    - name: Install Apache HTTP Server
      command: yum install -y httpd

    - name: Change directory
      command: cd /var/www/html

    - name: Download Jupiter repository
      command: wget https://github.com/azeezsalu/jupiter/archive/refs/heads/main.zip
      register: download_result
      changed_when: false  # Mark the task as unchanged even if the file already exists

    - name: Unzip Jupiter repository
      command: unzip main.zip
      args:
        chdir: /var/www/html
      changed_when: download_result.rc == 0 and download_result.stdout.find('Archive:') == -1

    - name: Check if Jupiter directory exists
      stat:
        path: /var/www/html/jupiter-main
      register: jupiter_dir_check

    - name: Copy files to web directory
      command: cp -r /var/www/html/jupiter-main/* /var/www/html/
      args:
        chdir: /var/www/html
      when: not jupiter_dir_check.stat.exists

    - name: Remove temporary files
      file:
        path: "/var/www/html/{{ item }}"
        state: absent
      loop:
        - jupiter-main
        - main.zip

    - name: Enable Apache HTTPd
      command: systemctl enable httpd
